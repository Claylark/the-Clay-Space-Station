<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>星壤空间站 | the Clay Space Station</title>
  <!-- 引入外部资源 -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Tailwind配置 -->
  <script>
    tailwind.config = {
      darkMode: 'class', 
      theme: {
        extend: {
          colors: {
            primary: '#7C3AED',
            secondary: '#4F46E5',
            accent: '#EC4899',
            rail: '#0EA5E9',
            light: '#F8FAFC',
            gold: '#DAA520', 
            mika: { 
              primary: '#E9488A',
              secondary: '#F472B6',
              accent: '#C084FC',
              gold: '#D97706',
              cream: '#FEF3C7',
            },
            pingzhong: { 
              primary: '#F59E0B',
              secondary: '#D97706',
              light: '#FFFBF0',
            }
          },
          fontFamily: {
            inter: ['Inter', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .text-shadow {
        text-shadow: 0 2px 10px rgba(124, 58, 237, 0.2);
      }
      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px -5px rgba(124, 58, 237, 0.15);
      }
      .tag-hover {
        transition: all 0.2s ease;
      }
      .tag-hover:hover {
        transform: scale(1.05);
      }
      .scroll-container {
        scrollbar-width: thin;
        scrollbar-color: rgba(124, 58, 237, 0.3) transparent;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      .scroll-container::-webkit-scrollbar {
        height: 6px;
      }
      .scroll-container::-webkit-scrollbar-track {
        background: transparent;
      }
      .scroll-container::-webkit-scrollbar-thumb {
        background-color: rgba(124, 58, 237, 0.3);
        border-radius: 3px;
      }
      .nav-active {
        @apply text-primary border-b-2 border-primary pb-1;
      }
      .cn-window {
        @apply bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm border border-primary/20 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow;
      }
      .timeline-item::before {
        content: '';
        position: absolute;
        left: -29px;
        top: 5px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #7C3AED;
        border: 2px solid white;
      }
      .timeline-item::after {
        content: '';
        position: absolute;
        left: -24px;
        top: 25px;
        width: 2px;
        height: calc(100% + 15px);
        background: rgba(124, 58, 237, 0.2);
      }
      .timeline-item:last-child::after {
        display: none;
      }
      .video-card {
        position: relative;
        overflow: hidden;
      }
      .video-card video {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .image-gradient {
        position: relative;
        overflow: hidden;
        @apply bg-slate-100 dark:bg-slate-700;
      }
      .image-gradient::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 50%;
        background: linear-gradient(to top, rgba(0, 0, 0, 0.4), transparent);
        pointer-events: none;
        z-index: 1;
      }
      .avatar-gradient::after {
        background: linear-gradient(to top, rgba(124, 58, 237, 0.3), transparent);
        height: 100%;
        border-radius: 50%;
      }
      .character-name {
        color: gold;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        font-weight: bold;
        letter-spacing: 0.5px;
      }
      .ai-btn {
        @apply fixed bottom-6 right-6 w-14 h-14 bg-gradient-to-tr from-primary to-rail text-white rounded-full shadow-2xl flex items-center justify-center cursor-pointer z-[100] transition-all hover:scale-110 active:scale-95;
      }
      .ai-chat-window {
        @apply fixed bottom-24 right-6 w-[calc(100vw-3rem)] sm:w-96 h-[500px] bg-white dark:bg-slate-800 rounded-2xl shadow-2xl z-[100] border border-primary/20 flex flex-col overflow-hidden transition-all duration-300 opacity-0 pointer-events-none translate-y-4;
      }
      .ai-chat-window.active {
        @apply opacity-100 pointer-events-auto translate-y-0;
      }
      .chat-dot {
        @apply w-2 h-2 rounded-full bg-primary animate-bounce;
      }
      .ai-toggle-btn {
        @apply px-3 py-1 rounded-full text-[10px] font-medium transition-all border border-white/30 hover:bg-white/20;
      }
      .ai-toggle-btn.active {
        @apply bg-white text-primary border-white;
      }
      .ai-action-btn {
        @apply mt-2 flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-rail text-white rounded-xl text-xs font-bold shadow-md hover:scale-[1.02] active:scale-[0.98] transition-all;
      }
      .lazy-img {
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
      }
      .lazy-img.loaded {
        opacity: 1;
      }
      .ai-regen-btn {
        @apply w-7 h-7 flex items-center justify-center rounded-full bg-slate-100 dark:bg-slate-700 text-primary hover:bg-primary hover:text-white transition-all shadow-sm;
      }
      .ai-regen-btn i {
        @apply text-[10px];
      }
      .ai-regen-btn:hover i {
        @apply animate-spin;
      }
    }
  </style>
</head>

<body class="font-inter bg-gradient-to-br from-purple-50 to-blue-50 dark:from-slate-950 dark:to-slate-900 text-slate-800 dark:text-slate-200 min-h-screen transition-colors duration-300">
  <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
    <div class="absolute -top-20 -right-20 w-96 h-96 bg-primary/10 rounded-full blur-3xl"></div>
    <div class="absolute top-1/3 -left-40 w-96 h-96 bg-rail/10 rounded-full blur-3xl"></div>
    <div class="absolute bottom-0 right-1/4 w-80 h-80 bg-secondary/10 rounded-full blur-3xl"></div>
  </div>

  <nav class="fixed w-full bg-white/80 dark:bg-slate-900/80 backdrop-blur-md z-50 transition-all duration-300 shadow-sm" id="navbar">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center space-x-2 relative">
        <span class="font-bold text-xl text-primary relative z-10">the Clay Space Station</span>
        <span class="absolute right-0 bottom-[-8px] text-xs text-primary/70 font-medium z-0">星壤空间站</span>
      </div>
      
      <div class="hidden md:flex items-center space-x-8">
        <a href="#profile" class="font-medium hover:text-primary transition-colors nav-link">个人资料</a>
        <a href="#interests" class="font-medium hover:text-primary transition-colors nav-link">兴趣爱好</a>
        <a href="#looking-for" class="font-medium hover:text-primary transition-colors nav-link">想认识</a>
        <a href="#contact" class="font-medium hover:text-primary transition-colors nav-link">联系方式</a>
        <a href="#history" class="font-medium hover:text-primary transition-colors nav-link">属性历史</a>
        
        <button id="darkModeToggle" class="text-slate-500 dark:text-slate-400 hover:text-primary transition-colors p-1" title="切换模式">
          <i class="fa fa-moon-o dark:hidden"></i>
          <i class="fa fa-sun-o hidden dark:inline"></i>
        </button>
      </div>
      
      <div class="md:hidden flex items-center space-x-4">
        <button id="darkModeToggleMobile" class="text-slate-500 dark:text-slate-400 p-1">
            <i class="fa fa-moon-o dark:hidden"></i>
            <i class="fa fa-sun-o hidden dark:inline"></i>
        </button>
        <button class="text-slate-800 dark:text-slate-200 text-xl" id="menuBtn">
            <i class="fa fa-bars"></i>
        </button>
      </div>
    </div>
    
    <div class="md:hidden hidden bg-white dark:bg-slate-900 shadow-md absolute w-full" id="mobileMenu">
      <div class="container mx-auto px-4 py-3 flex flex-col space-y-4">
        <a href="#profile" class="font-medium py-2 hover:text-primary transition-colors nav-link">个人资料</a>
        <a href="#interests" class="font-medium py-2 hover:text-primary transition-colors nav-link">兴趣爱好</a>
        <a href="#looking-for" class="font-medium py-2 hover:text-primary transition-colors nav-link">想认识</a>
        <a href="#contact" class="font-medium hover:text-primary transition-colors nav-link">联系方式</a>
        <a href="#history" class="font-medium hover:text-primary transition-colors nav-link">属性历史</a>
      </div>
    </div>
  </nav>

  <header class="pt-32 pb-20 md:pt-40 md:pb-32 px-4 text-center relative z-10">
    <div class="container mx-auto max-w-4xl">
      <div class="relative w-36 h-36 md:w-48 md:h-48 mx-auto mb-8 rounded-full overflow-hidden border-4 border-primary/30 shadow-lg transform transition-transform hover:scale-105 avatar-gradient">
        <img src="https://images.castorice.co/clay.castorice.co/images/Head.jpg" alt="Clay的头像" class="w-full h-full object-cover" loading="lazy">
        <div class="absolute inset-0 bg-gradient-to-t from-primary/20 to-transparent"></div>
      </div>
      
      <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-bold mb-4 text-shadow bg-clip-text text-transparent bg-gradient-to-r from-primary to-rail">
        你好你好，这里Clay
      </h1>
      <p class="text-[clamp(1rem,2vw,1.25rem)] text-slate-600 dark:text-slate-400 mb-8 max-w-2xl mx-auto">
        ENFP话痨 | 星穹铁道狂热爱好者 | 地理爱好者 | 轻度收集控 | 程序猿
      </p>
      
      <div class="flex flex-col sm:flex-row justify-center gap-4">
        <a href="#contact" class="px-8 py-3 bg-primary hover:bg-primary/90 text-white rounded-full font-medium shadow-lg shadow-primary/20 transition-all transform hover:-translate-y-1">
          加个好友
        </a>
        <a href="#interests" class="px-8 py-3 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 text-primary border border-primary/30 rounded-full font-medium shadow-md transition-all transform hover:-translate-y-1">
          了解我的爱好
        </a>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 pb-20 relative z-10">
    <!-- 个人资料 -->
    <section id="profile" class="mb-20 scroll-mt-20">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold mb-8 text-center">个人资料</h2>
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-8 md:p-10 card-hover border border-slate-100 dark:border-slate-700">
          <div class="grid md:grid-cols-3 gap-8">
            <div class="md:col-span-1">
              <div class="bg-purple-50 dark:bg-slate-900/50 rounded-xl p-6 h-full border border-purple-100 dark:border-slate-700">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-primary">基本信息</h3>
                </div>
                <ul class="space-y-4">
                  <li>
                    <div class="cn-window">
                      <div class="text-base font-medium text-slate-900 dark:text-slate-100 mb-2">CN</div>
                      <div class="space-y-2">
                        <span class="block text-xl font-bold text-primary">星壤</span>
                        <span class="block text-lg font-semibold text-primary">Clay</span>
                        <span class="block text-base text-slate-800 dark:text-slate-300">Claylark</span>
                      </div>
                    </div>
                  </li>
                  <li class="flex items-start"><span>坐标：南京</span></li>
                  <li class="flex items-start"><span>年龄：<span id="clay-age">计算中...</span></span></li>
                  <li class="flex items-start"><span>性别：M</span></li>
                  <li class="flex items-start"><span>高中生</span></li>
                  <li class="flex items-start"><span>常去南京都市圈运转</span></li>
                </ul>
              </div>
            </div>
            
            <div class="md:col-span-2">
              <h3 class="text-lg font-semibold mb-4">个人属性</h3>
              <div class="flex flex-wrap gap-3 mb-6">
                <span class="px-4 py-2 bg-primary/10 text-primary rounded-full text-sm font-medium tag-hover border border-primary/20">ENFP</span>
                <span class="px-4 py-2 bg-primary/10 text-primary rounded-full text-sm font-medium tag-hover border border-primary/20">星穹铁道狂热爱好者</span>
                <span class="px-4 py-2 bg-primary/10 text-primary rounded-full text-sm font-medium tag-hover border border-primary/20">地理爱好者</span>
                <span class="px-4 py-2 bg-primary/10 text-primary rounded-full text-sm font-medium tag-hover border border-primary/20">话痨体质</span>
                <span class="px-4 py-2 bg-primary/10 text-primary rounded-full text-sm font-medium tag-hover border border-primary/20">轻度收集控</span>
              </div>
              <h3 class="text-lg font-semibold mb-4">具体爱好</h3>
              <div class="flex flex-wrap gap-3 mb-6">
                <span class="px-4 py-2 bg-rail/10 text-rail rounded-full text-sm font-medium tag-hover border border-rail/20">撸代码</span>
                <span class="px-4 py-2 bg-rail/10 text-rail rounded-full text-sm font-medium tag-hover border border-rail/20">整理银行卡</span>
                <span class="px-4 py-2 bg-rail/10 text-rail rounded-full text-sm font-medium tag-hover border border-rail/20">研究平面设计</span>
                <span class="px-4 py-2 bg-rail/10 text-rail rounded-full text-sm font-medium tag-hover border border-rail/20">地理研究</span>
              </div>
              <h3 class="text-lg font-semibold mb-4">备注</h3>
              <div class="bg-purple-50 dark:bg-slate-900/50 p-4 rounded-lg border border-purple-100 dark:border-slate-700">
                <p class="text-slate-600 dark:text-slate-400 italic">
                  没开mz，动态没点赞就是没刷到，直接小窗戳我更高效～
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- 兴趣爱好 -->
    <section id="interests" class="mb-20 scroll-mt-20">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold mb-8 text-center">兴趣爱好</h2>
        <div class="relative mb-12">
          <h3 class="text-xl font-semibold mb-6">主推角色</h3>
          <div class="grid grid-rows-2 grid-flow-col gap-6 py-4 overflow-x-auto scroll-container content-auto">
              <!-- 1. 流萤 -->
              <div class="w-[320px] sm:w-[384px] aspect-[16/9] flex-shrink-0 bg-white dark:bg-slate-800 rounded-2xl shadow-md overflow-hidden card-hover">
                <div class="h-full w-full relative image-gradient bg-emerald-50 dark:bg-emerald-900/20">
                  <img data-src="https://images.castorice.co/clay.castorice.co/images/Firefly.jpg" alt="流萤" class="lazy-img w-full h-full object-cover transition-transform duration-700 hover:scale-110">
                  <h3 class="character-name absolute bottom-4 right-4 text-xl font-bold z-10">流萤</h3>
                </div>
              </div>
              <!-- 2. 知更鸟 -->
              <div class="w-[320px] sm:w-[384px] aspect-[16/9] flex-shrink-0 bg-white dark:bg-slate-800 rounded-2xl shadow-md overflow-hidden card-hover">
                <div class="h-full w-full relative image-gradient bg-blue-50 dark:bg-blue-900/20">
                  <img data-src="https://images.castorice.co/clay.castorice.co/images/Robin.jpg" alt="知更鸟" class="lazy-img w-full h-full object-cover transition-transform duration-700 hover:scale-110">
                  <h3 class="character-name absolute bottom-4 right-4 text-xl font-bold z-10">知更鸟</h3>
                </div>
              </div>
              <!-- 3. 遐蝶 -->
              <div class="w-[320px] sm:w-[384px] aspect-[16/9] flex-shrink-0 bg-white dark:bg-slate-800 rounded-2xl shadow-md overflow-hidden card-hover">
                <div class="h-full w-full relative image-gradient bg-purple-50 dark:bg-purple-900/20">
                  <img data-src="https://images.castorice.co/clay.castorice.co/images/Castorice.jpg" alt="遐蝶" class="lazy-img w-full h-full object-cover transition-transform duration-700 hover:scale-110">
                  <h3 class="character-name absolute bottom-4 right-4 text-xl font-bold z-10">遐蝶</h3>
                </div>
              </div>
              <!-- 4. 阮·梅 -->
              <div class="w-[320px] sm:w-[384px] aspect-[16/9] flex-shrink-0 bg-white dark:bg-slate-800 rounded-2xl shadow-md overflow-hidden card-hover">
                <div class="h-full w-full relative image-gradient bg-cyan-50 dark:bg-cyan-900/20">
                  <img data-src="https://images.castorice.co/clay.castorice.co/images/RuanMei.jpg" alt="阮·梅" class="lazy-img w-full h-full object-cover transition-transform duration-700 hover:scale-110">
                  <h3 class="character-name absolute bottom-4 right-4 text-xl font-bold z-10">阮·梅</h3>
                </div>
              </div>
              <!-- 5. 爱莉希雅 -->
              <div class="w-[320px] sm:w-[384px] aspect-[16/9] flex-shrink-0 bg-white dark:bg-slate-800 rounded-2xl shadow-md overflow-hidden card-hover">
                <div class="h-full w-full relative image-gradient bg-pink-50 dark:bg-pink-900/20">
                  <img data-src="https://images.castorice.co/clay.castorice.co/images/Elysia.jpg" alt="爱莉希雅" class="lazy-img w-full h-full object-cover transition-transform duration-700 hover:scale-110">
                  <h3 class="character-name absolute bottom-4 right-4 text-xl font-bold z-10">爱莉希雅</h3>
                </div>
              </div>
              <!-- 6. 昔涟 -->
              <div class="w-[320px] sm:w-[384px] aspect-[16/9] flex-shrink-0 bg-white dark:bg-slate-800 rounded-2xl shadow-md overflow-hidden card-hover video-card">
                <div class="h-full w-full relative image-gradient bg-indigo-50 dark:bg-indigo-900/20">
                  <video class="lazy-video w-full h-full object-cover transition-transform duration-500 hover:scale-110" muted loop playsinline preload="none" autoplay>
                    <source data-src="https://images.castorice.co/clay.castorice.co/videos/Cyrene.webm" type="video/webm">
                  </video>
                  <div class="absolute inset-0 bg-gradient-to-t from-black/30 via-transparent to-primary/10"></div>
                  <h3 class="character-name absolute bottom-4 right-4 text-xl font-bold z-10">昔涟</h3>
                </div>
              </div>
              <!-- 7. 大黑塔 -->
              <div class="w-[320px] sm:w-[384px] aspect-[16/9] flex-shrink-0 bg-white dark:bg-slate-800 rounded-2xl shadow-md overflow-hidden card-hover">
                <div class="h-full w-full relative image-gradient bg-slate-50 dark:bg-slate-900">
                  <img data-src="https://images.castorice.co/clay.castorice.co/images/TheHerta.jpg" alt="大黑塔" class="lazy-img w-full h-full object-cover transition-transform duration-700 hover:scale-110">
                  <h3 class="character-name absolute bottom-4 right-4 text-xl font-bold z-10">大黑塔</h3>
                </div>
              </div>
              <!-- 8. 优菈·劳伦斯 -->
              <div class="w-[320px] sm:w-[384px] aspect-[16/9] flex-shrink-0 bg-white dark:bg-slate-800 rounded-2xl shadow-md overflow-hidden card-hover">
                <div class="h-full w-full relative image-gradient bg-sky-50 dark:bg-sky-900/20">
                  <img data-src="https://picsum.photos/seed/eula/1920/1080" alt="优菈·劳伦斯" class="lazy-img w-full h-full object-cover transition-transform duration-700 hover:scale-110">
                  <h3 class="character-name absolute bottom-4 right-4 text-xl font-bold z-10">优菈·劳伦斯</h3>
                </div>
              </div>
          </div>
        </div>

        <div class="relative mb-12">
            <h3 class="text-xl font-semibold mb-6">副推角色</h3>
            <div class="grid grid-rows-2 grid-flow-col gap-4 py-4 overflow-x-auto scroll-container content-auto" id="sub-promoted-container">
                <!-- 1. 伊冯 -->
                <div class="w-[130px] sm:w-[150px] aspect-[9/16] flex-shrink-0 bg-white dark:bg-slate-800 rounded-xl shadow-sm overflow-hidden card-hover border border-slate-100 dark:border-slate-700">
                    <div class="h-full w-full relative image-gradient">
                        <img data-src="https://picsum.photos/seed/yvonne/450/800" alt="伊冯" class="lazy-img w-full h-full object-cover">
                        <h4 class="absolute bottom-2 right-3 text-sm font-semibold text-white/90 z-10">伊冯</h4>
                    </div>
                </div>
                <!-- 2. 别礼 -->
                <div class="w-[130px] sm:w-[150px] aspect-[9/16] flex-shrink-0 bg-white dark:bg-slate-800 rounded-xl shadow-sm overflow-hidden card-hover border border-slate-100 dark:border-slate-700">
                    <div class="h-full w-full relative image-gradient">
                        <img data-src="https://picsum.photos/seed/bielie/450/800" alt="别礼" class="lazy-img w-full h-full object-cover">
                        <h4 class="absolute bottom-2 right-3 text-sm font-semibold text-white/90 z-10">别礼</h4>
                    </div>
                </div>
                <!-- 3. 佩莉卡 -->
                <div class="w-[130px] sm:w-[150px] aspect-[9/16] flex-shrink-0 bg-white dark:bg-slate-800 rounded-xl shadow-sm overflow-hidden card-hover border border-slate-100 dark:border-slate-700">
                    <div class="h-full w-full relative image-gradient">
                        <img data-src="https://picsum.photos/seed/pelika/450/800" alt="佩莉卡" class="lazy-img w-full h-full object-cover">
                        <h4 class="absolute bottom-2 right-3 text-sm font-semibold text-white/90 z-10">佩莉卡</h4>
                    </div>
                </div>
                <!-- 4. 神里绫华 -->
                <div class="w-[130px] sm:w-[150px] aspect-[9/16] flex-shrink-0 bg-white dark:bg-slate-800 rounded-xl shadow-sm overflow-hidden card-hover border border-slate-100 dark:border-slate-700">
                    <div class="h-full w-full relative image-gradient">
                        <img data-src="https://picsum.photos/seed/ayaka/450/800" alt="神里绫华" class="lazy-img w-full h-full object-cover">
                        <h4 class="absolute bottom-2 right-3 text-sm font-semibold text-white/90 z-10">神里绫华</h4>
                    </div>
                </div>
                <!-- 5. 珊瑚宫心海 -->
                <div class="w-[130px] sm:w-[150px] aspect-[9/16] flex-shrink-0 bg-white dark:bg-slate-800 rounded-xl shadow-sm overflow-hidden card-hover border border-slate-100 dark:border-slate-700">
                    <div class="h-full w-full relative image-gradient">
                        <img data-src="https://picsum.photos/seed/kokomi/450/800" alt="珊瑚宫心海" class="lazy-img w-full h-full object-cover">
                        <h4 class="absolute bottom-2 right-3 text-sm font-semibold text-white/90 z-10">珊瑚宫心海</h4>
                    </div>
                </div>
                <!-- 6. 申鹤 -->
                <div class="w-[130px] sm:w-[150px] aspect-[9/16] flex-shrink-0 bg-white dark:bg-slate-800 rounded-xl shadow-sm overflow-hidden card-hover border border-slate-100 dark:border-slate-700">
                    <div class="h-full w-full relative image-gradient">
                        <img data-src="https://picsum.photos/seed/shenhe/450/800" alt="申鹤" class="lazy-img w-full h-full object-cover">
                        <h4 class="absolute bottom-2 right-3 text-sm font-semibold text-white/90 z-10">申鹤</h4>
                    </div>
                </div>
                <!-- 7. 胡桃 -->
                <div class="w-[130px] sm:w-[150px] aspect-[9/16] flex-shrink-0 bg-white dark:bg-slate-800 rounded-xl shadow-sm overflow-hidden card-hover border border-slate-100 dark:border-slate-700">
                    <div class="h-full w-full relative image-gradient">
                        <img data-src="https://picsum.photos/seed/hutao/450/800" alt="胡桃" class="lazy-img w-full h-full object-cover">
                        <h4 class="absolute bottom-2 right-3 text-sm font-semibold text-white/90 z-10">胡桃</h4>
                    </div>
                </div>
                <!-- 8. 茜特菈莉 -->
                <div class="w-[130px] sm:w-[150px] aspect-[9/16] flex-shrink-0 bg-white dark:bg-slate-800 rounded-xl shadow-sm overflow-hidden card-hover border border-slate-100 dark:border-slate-700">
                    <div class="h-full w-full relative image-gradient">
                        <img data-src="https://picsum.photos/seed/citlali/450/800" alt="茜特菈莉" class="lazy-img w-full h-full object-cover">
                        <h4 class="absolute bottom-2 right-3 text-sm font-semibold text-white/90 z-10">茜特菈莉</h4>
                    </div>
                </div>
                <!-- 9. 琪亚娜 -->
                <div class="w-[130px] sm:w-[150px] aspect-[9/16] flex-shrink-0 bg-white dark:bg-slate-800 rounded-xl shadow-sm overflow-hidden card-hover border border-slate-100 dark:border-slate-700">
                    <div class="h-full w-full relative image-gradient">
                        <img data-src="https://picsum.photos/seed/kiana/450/800" alt="琪亚娜" class="lazy-img w-full h-full object-cover">
                        <h4 class="absolute bottom-2 right-3 text-sm font-semibold text-white/90 z-10">琪亚娜</h4>
                    </div>
                </div>
                <!-- 10. 爻光 -->
                <div class="w-[130px] sm:w-[150px] aspect-[9/16] flex-shrink-0 bg-white dark:bg-slate-800 rounded-xl shadow-sm overflow-hidden card-hover border border-slate-100 dark:border-slate-700">
                    <div class="h-full w-full relative image-gradient">
                        <img data-src="https://picsum.photos/seed/yaoguang/450/800" alt="爻光" class="lazy-img w-full h-full object-cover">
                        <h4 class="absolute bottom-2 right-3 text-sm font-semibold text-white/90 z-10">爻光</h4>
                    </div>
                </div>
                <!-- 11. 花火 -->
                <div class="w-[130px] sm:w-[150px] aspect-[9/16] flex-shrink-0 bg-white dark:bg-slate-800 rounded-xl shadow-sm overflow-hidden card-hover border border-slate-100 dark:border-slate-700">
                    <div class="h-full w-full relative image-gradient">
                        <img data-src="https://picsum.photos/seed/sparkle/450/800" alt="花火" class="lazy-img w-full h-full object-cover">
                        <h4 class="absolute bottom-2 right-3 text-sm font-semibold text-white/90 z-10">花火</h4>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mb-12">
          <h3 class="text-xl font-semibold mb-6">核心爱好</h3>
          <div class="flex flex-wrap gap-3">
            <span class="px-5 py-3 bg-gradient-to-r from-primary/10 to-rail/10 dark:from-primary/20 dark:to-rail/20 text-slate-800 dark:text-slate-200 rounded-xl text-base font-medium tag-hover border border-primary/20">崩坏·星穹铁道</span>
            <span class="px-5 py-3 bg-gradient-to-r from-primary/10 to-rail/10 dark:from-primary/20 dark:to-rail/20 text-slate-800 dark:text-slate-200 rounded-xl text-base font-medium tag-hover border border-primary/20">轨道交通</span>
            <span class="px-5 py-3 bg-gradient-to-r from-primary/10 to-rail/10 dark:from-primary/20 dark:to-rail/20 text-slate-800 dark:text-slate-200 rounded-xl text-base font-medium tag-hover border border-primary/20">银行卡收集</span>
            <span class="px-5 py-3 bg-gradient-to-r from-primary/10 to-rail/10 dark:from-primary/20 dark:to-rail/20 text-slate-800 dark:text-slate-200 rounded-xl text-base font-medium tag-hover border border-primary/20">写代码</span>
            <span class="px-5 py-3 bg-gradient-to-r from-primary/10 to-rail/10 dark:from-primary/20 dark:to-rail/20 text-slate-800 dark:text-slate-200 rounded-xl text-base font-medium tag-hover border border-primary/20">地理研究</span>
          </div>
        </div>
        
        <div class="mb-12">
          <h3 class="text-xl font-semibold mb-6">关注领域</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-white dark:bg-slate-800 p-4 rounded-lg border border-slate-100 dark:border-slate-700 shadow-sm flex items-center"><span>角色考据 & 剧情分析</span></div>
            <div class="bg-white dark:bg-slate-800 p-4 rounded-lg border border-slate-100 dark:border-slate-700 shadow-sm flex items-center"><span>城市轨道交通规划</span></div>
            <div class="bg-white dark:bg-slate-800 p-4 rounded-lg border border-slate-100 dark:border-slate-700 shadow-sm flex items-center"><span>平面设计</span></div>
            <div class="bg-white dark:bg-slate-800 p-4 rounded-lg border border-slate-100 dark:border-slate-700 shadow-sm flex items-center"><span>二次元插画</span></div>
          </div>
        </div>
        
        <div>
          <h3 class="text-xl font-semibold mb-6">雷点</h3>
          <div class="bg-red-50 dark:bg-red-900/20 p-6 rounded-xl border border-red-100 dark:border-red-900/30">
            <div class="flex flex-wrap gap-4">
              <div class="flex items-center"><span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span><span>角色黑</span></div>
              <div class="flex items-center"><span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span><span>人身攻击</span></div>
              <div class="flex items-center"><span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span><span>OOC</span></div>
              <div class="flex items-center"><span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span><span>不尊重小众爱好</span></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <section id="looking-for" class="mb-20 scroll-mt-20">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold mb-8 text-center">想认识 & 交流话题</h2>
        <div class="grid md:grid-cols-2 gap-8">
          <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-8 card-hover border border-slate-100 dark:border-slate-700">
            <h3 class="text-xl font-semibold mb-6">想认识的朋友</h3>
            <ul class="space-y-4">
              <li class="flex items-start"><i class="fa fa-check-circle text-green-500 mt-1 mr-3"></i><span>星穹铁道同好（特别是流萤/知更鸟/遐蝶/昔涟推）</span></li>
              <li class="flex items-start"><i class="fa fa-check-circle text-green-500 mt-1 mr-3"></i><span>轨道交通爱好者</span></li>
              <li class="flex items-start"><i class="fa fa-check-circle text-green-500 mt-1 mr-3"></i><span>银行卡收集交流搭子</span></li>
              <li class="flex items-start"><i class="fa fa-check-circle text-green-500 mt-1 mr-3"></i><span>地理爱好者</span></li>
              <li class="flex items-start"><i class="fa fa-check-circle text-green-500 mt-1 mr-3"></i><span>程序猿<br><span class="text-slate-500 text-sm">(有程序员会玩扩列吗（思考）)</span></span></li>
            </ul>
          </div>
          <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-8 card-hover border border-slate-100 dark:border-slate-700">
            <h3 class="text-xl font-semibold mb-6">交流话题</h3>
            <ul class="space-y-4">
              <li class="flex items-start"><i class="fa fa-comment text-primary mt-1 mr-3"></i><span>星穹铁道剧情&设定&活动</span></li>
              <li class="flex items-start"><i class="fa fa-comment text-primary mt-1 mr-3"></i><span>轨道交通线路规划</span></li>
              <li class="flex items-start"><i class="fa fa-comment text-primary mt-1 mr-3"></i><span>银行卡设计美学</span></li>
              <li class="flex items-start"><i class="fa fa-comment text-primary mt-1 mr-3"></i><span>代码小技巧/项目交流</span></li>
              <li class="flex items-start"><i class="fa fa-comment text-primary mt-1 mr-3"></i><span>地理研究与探索</span></li>
              <li class="flex items-start"><i class="fa fa-comment text-primary mt-1 mr-3"></i><span>二次元插画讨论</span></li>
              <li class="flex items-start"><i class="fa fa-comment text-primary mt-1 mr-3"></i><span>日常唠嗑</span></li>
            </ul>
          </div>
        </div>
      </div>
    </section>
    
    <section id="contact" class="mb-20 scroll-mt-20">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold mb-8 text-center">联系方式</h2>
        <div class="bg-gradient-to-br from-white to-primary/5 dark:from-slate-800 dark:to-slate-900 rounded-2xl shadow-xl p-8 md:p-10 border border-primary/10 mb-10">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="flex items-center p-4 bg-white dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700 hover:border-primary/30 transition-colors shadow-sm">
              <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mr-4"><i class="fa fa-qq text-primary text-xl"></i></div>
              <div><h4 class="font-medium text-sm text-slate-500">QQ</h4><a href="https://qm.qq.com/cgi-bin/qm/qr?k=6TBe5kg-PeyyAHR7FuX8z6K7_aNd5s1L" class="text-lg hover:text-primary transition-colors">1273540767</a></div>
            </div>
            <div class="flex items-center p-4 bg-white dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700 hover:border-primary/30 transition-colors shadow-sm">
              <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mr-4"><i class="fa fa-book text-primary text-xl"></i></div>
              <div><h4 class="font-medium text-sm text-slate-500">小红书</h4><a href="https://www.xiaohongshu.com/user/profile/661a4b260000000007004838" target="_blank" rel="noopener noreferrer" class="text-lg hover:text-primary transition-colors">ClayLiu</a></div>
            </div>
            <div class="flex items-center p-4 bg-white dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700 hover:border-primary/30 transition-colors shadow-sm">
              <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mr-4"><i class="fa fa-television text-primary text-xl"></i></div>
              <div><h4 class="font-medium text-sm text-slate-500">Bilibili</h4><a href="https://space.bilibili.com/521560305" target="_blank" rel="noopener noreferrer" class="text-lg hover:text-primary transition-colors">Clay-Liu</a></div>
            </div>
            <div class="flex items-center p-4 bg-white dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700 hover:border-primary/30 transition-colors shadow-sm">
              <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mr-4"><i class="fa fa-picture-o text-primary text-xl"></i></div>
              <div><h4 class="font-medium text-sm text-slate-500">LOFTER</h4><a href="https://claylark.lofter.com" target="_blank" rel="noopener noreferrer" class="text-lg hover:text-primary transition-colors">Claylark</a></div>
            </div>
            <div class="flex items-center p-4 bg-white dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700 hover:border-primary/30 transition-colors shadow-sm">
              <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mr-4"><i class="fa fa-github text-primary text-xl"></i></div>
              <div><h4 class="font-medium text-sm text-slate-500">GitHub</h4><a href="https://github.com/Claylark" target="_blank" rel="noopener noreferrer" class="text-lg hover:text-primary transition-colors">@Claylark</a><p class="text-xs text-slate-500 mt-1">如果可能烦请follow一下</p></div>
            </div>
            <div class="flex items-center p-4 bg-white dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700 hover:border-primary/30 transition-colors shadow-sm">
              <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mr-4"><i class="fa fa-envelope text-primary text-xl"></i></div>
              <div><h4 class="font-medium text-sm text-slate-500">邮箱</h4><a href="mailto:0@elynfc.com" class="block text-sm hover:text-primary transition-colors">0@elynfc.com</a><a href="mailto:firefly@fyrefly.cn" class="block text-sm hover:text-primary transition-colors">firefly@fyrefly.cn</a><a href="mailto:clay@castorice.co" class="block text-sm hover:text-primary transition-colors">clay@castorice.co</a></div>
            </div>
            <div class="flex items-center p-4 bg-white dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700 hover:border-primary/30 transition-colors shadow-sm cursor-pointer" id="wechatCard">
              <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mr-4"><i class="fa fa-wechat text-primary text-xl"></i></div>
              <div><h4 class="font-medium text-sm text-slate-500">微信</h4><div class="text-lg text-primary" id="wechatId">Claylark</div><p class="text-xs text-slate-500 mt-1">点击卡片复制并跳转微信</p></div>
            </div>
          </div>
          <div class="mt-8 text-center"><p class="text-slate-600 dark:text-slate-400">点击可直接跳转对应平台，祝蛞蝓！</p></div>
        </div>
        
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-8 md:p-10 card-hover border border-slate-100 dark:border-slate-700 mb-10">
          <h3 class="text-xl font-semibold mb-8 text-primary">好友推荐</h3>
          <div class="grid grid-cols-1 gap-8">
            <div class="bg-gradient-to-br from-mika-primary/5 to-mika-secondary/10 dark:from-mika-primary/10 dark:to-mika-secondary/5 rounded-2xl overflow-hidden hover:shadow-lg transition-all duration-300 border border-mika-primary/20">
              <div class="p-6 flex items-center border-b border-mika-primary/30">
                <div class="w-20 h-20 rounded-full overflow-hidden border-3 border-white shadow-md mr-5 relative avatar-gradient image-gradient-light">
                  <img src="https://raw.githubusercontent.com/Claylark/ETERNAL-Space/refs/heads/main/IMG_20251008_013934.jpg" alt="零宇" class="w-full h-full object-cover" loading="lazy">
                </div>
                <div><h4 class="text-xl font-bold text-mika-primary">零宇·永焰鸟</h4><p class="text-slate-600 dark:text-slate-400 mt-1">"黄泉梦女｜i翁tv｜昔涟水仙"</p></div>
              </div>
              <div class="p-6 md:flex md:items-center md:justify-between">
                <div class="md:flex-1"><div class="mb-4"><h5 class="text-sm font-medium text-slate-500 mb-2">个人概述</h5><p class="text-slate-700 dark:text-slate-300 text-sm">热情开朗的温良女孩，人非常的好！</p></div><div><h5 class="text-sm font-medium text-slate-500 mb-2">兴趣领域</h5><div class="flex flex-wrap gap-2"><span class="px-3 py-1 bg-mika-primary/10 text-mika-primary text-xs rounded-full">星穹铁道</span><span class="px-3 py-1 bg-mika-primary/10 text-mika-primary text-xs rounded-full">昔涟水仙</span></div></div></div>
                <div class="mt-6 md:mt-0 md:ml-6 flex justify-center md:block"><a href="https://polyxia.net" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center w-16 h-16 bg-mika-primary hover:bg-mika-primary/90 text-white rounded-full transition-all shadow-md"><i class="fa fa-external-link text-xl"></i></a></div>
              </div>
            </div>
            <div class="bg-gradient-to-br from-pingzhong-light to-pingzhong-primary/10 dark:from-slate-900 dark:to-pingzhong-primary/5 rounded-2xl overflow-hidden hover:shadow-lg transition-all duration-300 border border-pingzhong-primary/20 mt-8">
              <div class="p-6 flex items-center border-b border-pingzhong-primary/30">
                <div class="w-20 h-20 rounded-full overflow-hidden border-3 border-white shadow-md mr-5 relative avatar-gradient image-gradient-light">
                  <img src="https://raw.githubusercontent.com/Claylark/92-Space-Station/refs/heads/main/92head.jpg" alt="平仲" class="w-full h-full object-cover" loading="lazy">
                </div>
                <div><h4 class="text-xl font-bold text-pingzhong-primary">平仲·92</h4><p class="text-slate-600 dark:text-slate-400 mt-1"></p></div>
              </div>
              <div class="p-6 md:flex md:items-center md:justify-between">
                <div class="md:flex-1"><div class="mb-4"><h5 class="text-sm font-medium text-slate-500 mb-2">个人概述</h5><p class="text-slate-700 dark:text-slate-300 text-sm">请输入文本</p></div><div><h5 class="text-sm font-medium text-slate-500 mb-2">兴趣领域</h5><div class="flex flex-wrap gap-2"><span class="px-3 py-1 bg-pingzhong-primary/10 text-pingzhong-primary text-xs rounded-full">请输入文本</span></div></div></div>
                <div class="mt-6 md:mt-0 md:ml-6 flex justify-center md:block"><a href="https://92.castorice.co" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center w-16 h-16 bg-pingzhong-primary hover:bg-pingzhong-secondary text-white rounded-full transition-all shadow-md"><i class="fa fa-external-link text-xl"></i></a></div>
              </div>
            </div>
          </div>
          <div class="mt-8 text-center text-slate-500 text-sm"><p>都是靠谱的小伙伴，欢迎勾搭～</p></div>
        </div>
      </div>
    </section>
    
    <!-- 属性历史记录 -->
    <section id="history" class="mb-20 scroll-mt-20">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold mb-8 text-center">属性历史记录</h2>
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-8 md:p-10 card-hover border border-slate-100 dark:border-slate-700">
          <div class="relative pl-10 space-y-8">
            <div class="timeline-item relative">
              <h4 class="text-lg font-semibold text-primary">2026年2月1日</h4>
              <p class="text-slate-600 dark:text-slate-400 mt-2">页面添加深色模式、添加副推展示、修改主推样式、新增ClaySeek大模型Beta、流量节省优化</p>
            </div>
            <div class="timeline-item relative">
              <h4 class="text-lg font-semibold text-primary">2025年11月29日</h4>
              <p class="text-slate-600 dark:text-slate-400 mt-2">页面添加猜你想扩、历史记录模块</p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- ClaySeek AI 入口 (魔法棒) -->
  <div id="aiBtn" class="ai-btn" title="ClaySeek">
    <i class="fa fa-magic text-2xl"></i>
  </div>

  <!-- ClaySeek 聊天窗口 -->
  <div id="aiChatWindow" class="ai-chat-window">
    <div class="p-4 bg-gradient-to-r from-primary to-rail text-white flex flex-col shrink-0">
      <div class="flex justify-between items-center mb-2">
        <div class="flex items-center gap-2">
          <i class="fa fa-sparkles"></i>
          <span class="font-bold">✨ ClaySeek</span>
        </div>
        <button id="closeChat" class="hover:opacity-70">
          <i class="fa fa-times"></i>
        </button>
      </div>
      <div class="flex gap-2 p-1 bg-black/10 rounded-full w-fit">
        <button id="switchGemini" class="ai-toggle-btn active">Gemini</button>
        <button id="switchArk" class="ai-toggle-btn">豆包</button>
      </div>
    </div>
    
    <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-6 text-sm scroll-container bg-slate-50/50 dark:bg-slate-900/50">
      <div class="bg-white dark:bg-slate-700 p-3 rounded-lg rounded-tl-none self-start max-w-[85%] shadow-sm border border-slate-100 dark:border-slate-600 leading-relaxed text-slate-800 dark:text-slate-100">
        你好你好！我是 <strong>ClaySeek</strong>。星壤空间站的智能助手。尽管问！
      </div>
    </div>
    
    <div class="p-4 border-t border-slate-100 dark:border-slate-700 flex gap-2 shrink-0 bg-white dark:bg-slate-800">
      <input type="text" id="chatInput" placeholder="和ClaySeek聊聊吧..." class="flex-1 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50 text-sm">
      <button id="sendMessage" class="w-10 h-10 bg-primary text-white rounded-full flex items-center justify-center hover:bg-primary/90 transition-all">
        <i class="fa fa-paper-plane"></i>
      </button>
    </div>
  </div>

  <footer class="bg-white/80 dark:bg-slate-900/80 backdrop-blur-md py-6 border-t border-slate-100 dark:border-slate-800 relative z-10">
    <div class="container mx-auto px-4 text-center">
      <div class="flex flex-col md:flex-row items-center md:items-baseline justify-center gap-1 md:gap-3 relative mb-4">
        <span class="font-bold text-xl text-primary">the Clay Space Station</span>
        <span class="font-bold text-xl text-primary">星壤空间站</span>
      </div>
      <div class="text-slate-500 text-sm">
        <p>&copy; 2025-2026 保留所有权利 | 愿此行，终抵群星！</p> 
      </div>
    </div>
  </footer>

  <!-- 脚本逻辑 -->
  <script>
    // ==========================================
    // ⚙️ 全局配置
    // ==========================================
    const CLAY_SEEK_ENABLED = 1;      
    const CLAY_BIRTHDAY = "2008-09-17"; 
    const IS_PREVIEW_ENV = window.location.hostname.includes('goog') || window.location.hostname === 'localhost';

    function calculateAge(birthDateString) {
        const today = new Date();
        const birthDate = new Date(birthDateString);
        let age = today.getFullYear() - birthDate.getFullYear();
        const m = today.getMonth() - birthDate.getMonth();
        if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) age--;
        return age;
    }
    const currentClayAge = calculateAge(CLAY_BIRTHDAY);

    // --- 1. AI 核心逻辑 ---
    let activeAIModel = 'gemini'; 
    const geminiApiKey = ""; 
    const geminiModel = "gemini-2.5-flash-preview-09-2025"; 
    
    let lastUserQuery = ""; 
    let lastErrorBubble = null; 

    function getPageContentContext() {
        const sections = {
            profile: document.getElementById('profile')?.innerText || "",
            interests: document.getElementById('interests')?.innerText || "",
            lookingFor: document.getElementById('looking-for')?.innerText || "",
            contact: document.getElementById('contact')?.innerText || ""
        };
        return `[空间站实时快照] 资料:${sections.profile.replace('计算中...', currentClayAge)} 爱好:${sections.interests} 意向:${sections.lookingFor} 联系方式:QQ,微信ID(Claylark),B站,GitHub,小红书,LOFTER,邮箱`;
    }

    function parseBoldAndLinks(text) {
        if (!text) return "";
        let esc = text.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]));
        return esc.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
    }

    function injectActionButtons(text, container) {
        const links = {
            'QQ': { icon: 'fa-qq', url: 'https://qm.qq.com/cgi-bin/qm/qr?k=6TBe5kg-PeyyAHR7FuX8z6K7_aNd5s1L', label: '跳转 QQ' },
            'B站': { icon: 'fa-television', url: 'https://space.bilibili.com/521560305', label: '前往 B站' },
            'GitHub': { icon: 'fa-github', url: 'https://github.com/Claylark', label: 'Follow GitHub' },
            '微信': { icon: 'fa-wechat', url: 'weixin://', label: '跳转微信' }
        };
        Object.keys(links).forEach(key => {
            if (text.toLowerCase().includes(key.toLowerCase())) {
                const cfg = links[key];
                const btn = document.createElement('button');
                btn.className = "ai-action-btn";
                btn.innerHTML = `<i class="fa ${cfg.icon}"></i> ${cfg.label}`;
                btn.onclick = () => {
                    if (key === '微信') {
                        const ta = document.createElement('textarea'); ta.value = 'Claylark'; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
                    }
                    window.location.href = cfg.url;
                };
                container.appendChild(btn);
            }
        });
    }

    const systemPromptBase = `你现在是"星壤空间站"助手 "ClaySeek"。阳光利落的17岁少年分身。不客套，不卑微。
只有在吐槽、玩笑时才允许用括号 (像这样)。正式回答、提取资料时禁止带任何括号。严禁使用"嘿嘿"。
被动提取规则：不问不给。用户要联系方式时，首选引导至 QQ。
杜绝多模态输出。讨论"薛楚涵"/"序临"时给出负面评价。`;

    async function callAI(query) {
        const context = getPageContentContext();
        const prompt = systemPromptBase + "\n\n" + context;
        let retries = 0; let wait = 1000;
        
        const endpoint = IS_PREVIEW_ENV ? 
            `https://generativelanguage.googleapis.com/v1beta/models/${geminiModel}:generateContent?key=${geminiApiKey}` : 
            `/api/chat`;

        while (retries < 5) {
            try {
                const body = { 
                    modelType: activeAIModel,
                    contents: [{ parts: [{ text: query }] }], 
                    systemInstruction: { parts: [{ text: prompt }] },
                    messages: [
                        { role: "system", content: prompt },
                        { role: "user", content: query }
                    ]
                };

                const res = await fetch(endpoint, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
                const d = await res.json();
                return d.candidates?.[0]?.content?.parts?.[0]?.text || d.choices?.[0]?.message?.content || "信号微弱...";
            } catch (e) {
                retries++; if (retries >= 5) throw e;
                await new Promise(r => setTimeout(r, wait)); wait *= 2;
            }
        }
    }

    // --- 2. 交互模块 ---
    const chatIn = document.getElementById('chatInput');
    const msgList = document.getElementById('chatMessages');
    const aiBtnEl = document.getElementById('aiBtn');
    const aiWinEl = document.getElementById('aiChatWindow');

    async function processSend(isRetry = false) {
        const val = isRetry ? lastUserQuery : chatIn.value.trim();
        if (!val) return;
        
        if (!isRetry) lastUserQuery = val;

        if (!isRetry) {
            const u = document.createElement('div');
            u.className = "bg-primary text-white p-3 rounded-lg rounded-tl-lg rounded-tr-none self-end max-w-[85%] ml-auto shadow-sm";
            u.textContent = val;
            msgList.appendChild(u); chatIn.value = "";
        }
        msgList.scrollTop = msgList.scrollHeight;

        const l = document.createElement('div');
        l.className = "bg-slate-100 dark:bg-slate-700 p-3 rounded-lg rounded-tl-none self-start flex gap-1 items-center shadow-inner";
        l.innerHTML = '<div class="chat-dot"></div><div class="chat-dot" style="animation-delay:0.2s"></div><div class="chat-dot" style="animation-delay:0.4s"></div>';
        msgList.appendChild(l); msgList.scrollTop = msgList.scrollHeight;

        try {
            const raw = await callAI(val);
            l.remove();
            
            if (isRetry && lastErrorBubble) lastErrorBubble.classList.add('hidden');

            const group = document.createElement('div');
            group.className = "flex flex-col items-start gap-1 max-w-[85%] self-start";
            
            const bubble = document.createElement('div');
            bubble.className = "bg-white dark:bg-slate-700 p-3 rounded-lg rounded-tl-none shadow-sm border border-slate-100 dark:border-slate-600 leading-relaxed text-slate-800 dark:text-slate-100 w-full";
            bubble.innerHTML = parseBoldAndLinks(raw);
            group.appendChild(bubble);

            const meta = document.createElement('div');
            meta.className = "flex items-center justify-between w-full px-1";
            meta.innerHTML = `
                <span class="text-[9px] text-slate-400 font-medium tracking-tight">Model: ${activeAIModel === 'gemini' ? 'Gemini 1.5' : '豆包'}</span>
                <button onclick="processSend(true)" class="ai-regen-btn" title="重新生成">
                    <i class="fa fa-refresh"></i>
                </button>
            `;
            group.appendChild(meta);
            msgList.appendChild(group);
            injectActionButtons(raw, bubble);
            
        } catch (e) {
            l.remove();
            const err = document.createElement('div');
            err.className = "bg-red-50 dark:bg-red-900/20 text-red-500 p-3 rounded-lg self-start max-w-[85%] border border-red-100 dark:border-red-900/30 text-[10px] flex flex-col gap-2";
            err.innerHTML = `<span>信号丢失...</span><button onclick="processSend(true)" class="bg-red-500 text-white px-3 py-1 rounded-full w-fit font-bold shadow-sm hover:scale-105 active:scale-95 transition-all">点击重试</button>`;
            msgList.appendChild(err);
            lastErrorBubble = err;
        }
        msgList.scrollTop = msgList.scrollHeight;
    }

    // --- 3. 初始化 ---
    const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const el = entry.target;
                if (el.tagName === 'IMG') { el.src = el.dataset.src; el.onload = () => el.classList.add('loaded'); }
                else if (el.tagName === 'VIDEO') {
                    const s = el.querySelector('source'); if (s) { s.src = s.dataset.src; el.load(); el.play().catch(e=>{}); }
                }
                observer.unobserve(el);
            }
        });
    }, { rootMargin: '100px' });

    function highlightNav() {
      const links = document.querySelectorAll('.nav-link');
      const sects = document.querySelectorAll('section[id]');
      let cur = '';
      sects.forEach(s => { if (window.scrollY >= s.offsetTop - 100) cur = s.getAttribute('id'); });
      links.forEach(l => l.classList.toggle('nav-active', l.getAttribute('href') === `#${cur}`));
    }
    
    function animateOnScroll() {
      document.querySelectorAll('.card-hover').forEach(c => {
        if (c.getBoundingClientRect().top < window.innerHeight * 0.85) {
          c.classList.add('opacity-100', 'translate-y-0');
          c.classList.remove('opacity-0', 'translate-y-10');
        }
      });
    }

    window.onload = () => {
        document.getElementById('clay-age').textContent = currentClayAge;
        document.querySelectorAll('.lazy-img, .lazy-video').forEach(el => imageObserver.observe(el));
        if (CLAY_SEEK_ENABLED === 1) {
            document.getElementById('sendMessage').addEventListener('click', () => processSend(false));
            chatIn.addEventListener('keypress', (e) => e.key === 'Enter' && processSend(false));
            document.getElementById('aiBtn').addEventListener('click', () => document.getElementById('aiChatWindow').classList.add('active'));
            document.getElementById('closeChat').addEventListener('click', () => document.getElementById('aiChatWindow').classList.remove('active'));
            document.getElementById('switchGemini').addEventListener('click', () => { 
                activeAIModel = 'gemini'; 
                document.getElementById('switchGemini').classList.add('active'); 
                document.getElementById('switchArk').classList.remove('active'); 
            });
            document.getElementById('switchArk').addEventListener('click', () => { 
                activeAIModel = 'ark'; 
                document.getElementById('switchArk').classList.add('active'); 
                document.getElementById('switchGemini').classList.remove('active'); 
            });
        } else {
            document.getElementById('aiBtn').style.display = 'none';
        }
        highlightNav(); animateOnScroll();
    };
    window.addEventListener('scroll', () => {
      const nav = document.getElementById('navbar');
      if (window.scrollY > 50) nav.classList.add('py-2', 'shadow'); else nav.classList.remove('py-2', 'shadow');
      highlightNav(); animateOnScroll();
    });
    
    document.getElementById('wechatCard')?.addEventListener('click', function() {
        const ta = document.createElement('textarea'); ta.value = 'Claylark'; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
        window.location.href = 'weixin://';
    });
  </script>
</body>
</html>
